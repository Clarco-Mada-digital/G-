{% load tailwind_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="fr" class="{% if is_dark_theme %}dark{% endif %}">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>G+</title>
        {% tailwind_css %}
        <script
            src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.min.js"
            defer></script>
        <!-- Ajout du CDN de Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Urbanist:ital,wght@0,100..900;1,100..900&display=swap"
            rel="stylesheet">

    </head>

    <style>
    body {
        font-family: "Urbanist", sans-serif;
    font-optical-sizing: auto;
        font-weight: 550;
        font-style: normal;
        background-color: #F5F7FA;
    }

    
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    p {
        color: #396AFF;
    }

    input,
    select,
    textarea {
        border-radius: 20px;
    }
    </style>

    <body>
        <div class="flex h-screen bg-gray-50 dark:bg-[#323D4E]">
            <!-- Sidebar (hidden on small screens) -->
            <aside id="sidebar"
                class="w-64 p-3 bg-white dark:bg-secondary border fixed inset-y-0 left-0 transform -translate-x-full transition-transform duration-300 ease-in-out sm:translate-x-0 sm:relative sm:flex-shrink-0">
                <button id="sidebarClose"
                    class="text-gray-500 focus:outline-none sm:hidden">
                    <svg class="w-6 h-6" fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>

                <div class="px-6 py-4">
                    <a href="{% url 'accounts:index' %}">
                        <img src="/static/images/Logo mada-digital.png" alt="logo MADA-Digital">
                    </a>
                </div>

                <nav class="mt-6">
                    <a href="{% url 'caisse:index' %}"
                        class="flex items-center px-4 py-2 mt-2 {% if request.path == '/caisse/' %}text-blue-600 bg-blue-100  rounded-lg{% else %}text-gray-600 dark:text-white hover:bg-blue-100 rounded-lg{% endif %}">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path
                                d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                        </svg>
                        <span class="ml-3">Tableau de bord</span>
                    </a>
                    <a href="{% url 'caisse:operation' %}"
                        class="flex items-center px-4 py-2 mt-2 {% if request.path == '/caisse/operations/' %}text-blue-600 bg-blue-100 rounded-lg{% else %}text-gray-600 dark:text-white hover:bg-blue-100 rounded-lg{% endif %}">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 mr-2"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M7 13l5 5 5-5" />
                            <path d="M7 6l5-5 5 5" />
                        </svg>
                        <span class="ml-3">Opérations</span>
                    </a>
                    <a href="{% url 'caisse:listes' %}"
                        class="flex items-center px-4 py-2 mt-2 {% if request.path == '/caisse/listes/' %}text-blue-600 bg-blue-100 rounded-lg{% else %}text-gray-600 dark:text-white hover:bg-blue-100 rounded-lg{% endif %}">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
                            <path fill-rule="evenodd"
                                d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z"
                                clip-rule="evenodd" />
                        </svg>
                        <span class="ml-3">Listes</span>
                    </a>
                    <a href="{% url 'caisse:depenses' %}"
                        class="flex items-center px-4 py-2 mt-2 {% if request.path == '/caisse/depenses/' %}text-blue-600 bg-blue-100 rounded-lg{% else %}text-gray-600 dark:text-white hover:bg-blue-100 rounded-lg{% endif %}">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path
                                d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" />
                            <path fill-rule="evenodd"
                                d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"
                                clip-rule="evenodd" />
                        </svg>
                        <span class="ml-3">Dépenses</span>
                    </a>
                    <a href="{% url 'caisse:acteurs' %}"
                        class="flex items-center px-4 py-2 mt-2 {% if request.path == '/caisse/acteurs/' %}text-blue-600 bg-blue-100 rounded-lg{% else %}text-gray-600 dark:text-white hover:bg-blue-100 rounded-lg{% endif %}">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path
                                d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
                        </svg>
                        <span class="ml-3">Acteurs</span>
                    </a>
                    {% if request.user.is_staff %}
                    <!-- Nouvel élément pour les utilisateurs -->
                    <a href="{% url 'caisse:utilisateurs' %}"
                        class="flex items-center px-4 py-2 mt-2 {% if request.path == '/caisse/utilisateurs/' %}text-blue-600 bg-blue-100 rounded-lg{% else %}text-gray-600 dark:text-white hover:bg-blue-100 rounded-lg{% endif %}">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path
                                d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                        </svg>
                        <span class="ml-3">Utilisateurs</span>
                    </a>
                    {% endif %}
                    <a href="{% url 'caisse:historique' %}"
                        class="flex items-center px-4 py-2 mt-2 {% if request.path == '/caisse/historique/' %}text-blue-600 bg-blue-100 rounded-lg{% else %}text-gray-600 dark:text-white hover:bg-blue-100 rounded-lg{% endif %}">
                        <svg width="25" height="25" viewBox="0 0 25 25"
                            fill="none" xmlns="http://www.w3.org/2000/svg">

                            <path
                                d="M16.0859 17.1875L11.7188 12.8203V5.46875H13.2812V12.1719L17.1875 16.0859L16.0859 17.1875Z"
                                fill="currentColor" />

                            <path
                                d="M12.5 1.5625C11.0429 1.56271 9.60072 1.8553 8.25877 2.42294C6.91683 2.99058 5.70243 3.82174 4.6875 4.86719V1.5625H3.125V7.8125H9.375V6.25H5.53125C6.9969 4.62132 8.9867 3.55744 11.1551 3.24313C13.3235 2.92881 15.5335 3.38392 17.4012 4.52941C19.269 5.67489 20.6766 7.4384 21.3795 9.51364C22.0824 11.5889 22.0362 13.8448 21.249 15.8895C20.4617 17.9343 18.9832 19.6387 17.0701 20.7068C15.157 21.7749 12.9303 22.1392 10.7766 21.7364C8.62284 21.3336 6.67824 20.1892 5.28047 18.5019C3.88269 16.8146 3.12005 14.691 3.125 12.5H1.5625C1.5625 14.6632 2.20397 16.7779 3.4058 18.5765C4.60763 20.3752 6.31583 21.7771 8.3144 22.6049C10.313 23.4328 12.5121 23.6494 14.6338 23.2273C16.7555 22.8053 18.7043 21.7636 20.234 20.234C21.7636 18.7043 22.8053 16.7555 23.2273 14.6338C23.6494 12.5121 23.4328 10.313 22.6049 8.3144C21.7771 6.31583 20.3752 4.60763 18.5765 3.4058C16.7779 2.20397 14.6632 1.5625 12.5 1.5625Z"
                                fill="currentColor" />

                        </svg>
                        <span class="ml-3">Historique</span>
                    </a>
                    
                    <a href="{% url 'caisse:parametres' %}"
                        class="flex items-center px-4 py-2 mt-2 {% if request.path == '/caisse/parametres/' %}text-blue-600 bg-blue-100 rounded-lg{% else %}text-gray-600 dark:text-white hover:bg-blue-100 rounded-lg{% endif %}">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path
                                d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" />
                        </svg>
                        <span class="ml-3">Profil</span>
                    </a>
                </nav>
            </aside>

            <!-- Main content -->
            <div class="flex-1 flex flex-col">
                <!-- Header with button to toggle sidebar -->
                <header
                    class="flex items-center justify-between px-6 py-4 bg-white dark:bg-secondary">
                    <button id="sidebarToggle"
                        class="text-gray-500 focus:outline-none sm:hidden">
                        <svg class="w-6 h-6" fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <div class="font-bold text-2xl dark:text-white"> 
                    {% block title_page %}
                        
                    {% endblock title_page %}
                    </div>
                    <div class="flex items-center">
                        <!-- Button to toggle sidebar -->

                        <!-- Button to close sidebar (visible only on small screens) -->

                        <div class="flex items-center border mx-5 border-gray-500 bg-gray-50 dark:bg-secondary rounded-full px-4 group group-focus:border-blue-500 group:focus:ring-blue-500 transition-colors duration-200">
                            <div
                                class="flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400"
                                    xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <input type="text"
                                class="py-2 border-none focus:outline-none rounded-full bg-transparent focus:ring-0 dark:text-white"
                                placeholder="Entrer votre recherche ici">
                        </div>
                        <a href="{% url 'change_theme' %}" id="theme-toggle" class="mx-4">
                            <div class="flex items-center justify-center border rounded-full overflow-hidden cursor-pointer">
                                <div class="w-2/4 {% if not is_dark_theme %} bg-primary {% endif %} h-full p-2">
                                    <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9.20017 5.02319C7.00709 5.02319 5.22339 6.80689 5.22339 8.99996C5.22339 11.193 7.00709 12.9767 9.20017 12.9767C11.3932 12.9767 13.177 11.193 13.177 8.99996C13.177 6.80689 11.3932 5.02319 9.20017 5.02319ZM9.20017 11.6609C7.73812 11.6609 6.53924 10.462 6.53924 8.99996C6.53924 7.53791 7.73812 6.33903 9.20017 6.33903C10.6622 6.33903 11.8611 7.53791 11.8611 8.99996C11.8611 10.462 10.6622 11.6609 9.20017 11.6609Z" fill="white"/>
                                    <path d="M9.20001 2.94713C9.5509 2.94713 9.87255 2.65472 9.87255 2.27459V0.812541C9.87255 0.46165 9.58014 0.139999 9.20001 0.139999C8.84912 0.139999 8.52747 0.432409 8.52747 0.812541V2.30383C8.55671 2.65472 8.84912 2.94713 9.20001 2.94713Z" fill="white"/>
                                    <path d="M9.20001 15.0529C8.84912 15.0529 8.52747 15.3453 8.52747 15.7254V17.1875C8.52747 17.5384 8.81988 17.86 9.20001 17.86C9.5509 17.86 9.87255 17.5676 9.87255 17.1875V15.6962C9.87255 15.3453 9.5509 15.0529 9.20001 15.0529Z" fill="white"/>
                                    <path d="M13.9664 4.90619C14.1419 4.90619 14.3173 4.84771 14.4343 4.7015L15.37 3.76579C15.6332 3.50262 15.6332 3.09325 15.37 2.83008C15.1068 2.56691 14.6975 2.56691 14.4343 2.83008L13.4986 3.76579C13.2354 4.02896 13.2354 4.43833 13.4986 4.7015C13.6155 4.84771 13.791 4.90619 13.9664 4.90619Z" fill="white"/>
                                    <path d="M3.99509 13.2984L3.05938 14.2049C2.79621 14.468 2.79621 14.8774 3.05938 15.1406C3.17634 15.2575 3.35179 15.3453 3.52723 15.3453C3.70268 15.3453 3.87813 15.2868 3.99509 15.1406L4.9308 14.2049C5.19397 13.9417 5.19397 13.5323 4.9308 13.2691C4.66763 13.0352 4.22902 13.0352 3.99509 13.2984Z" fill="white"/>
                                    <path d="M17.3874 8.35678H15.8961C15.5452 8.35678 15.2236 8.64919 15.2236 9.02932C15.2236 9.38021 15.516 9.70186 15.8961 9.70186H17.3874C17.7383 9.70186 18.06 9.40945 18.06 9.02932C18.06 8.64919 17.7383 8.35678 17.3874 8.35678Z" fill="white"/>
                                    <path d="M3.14711 8.99999C3.14711 8.6491 2.8547 8.32745 2.47456 8.32745H1.01251C0.661617 8.32745 0.339966 8.61986 0.339966 8.99999C0.339966 9.35089 0.632376 9.67254 1.01251 9.67254H2.5038C2.8547 9.67254 3.14711 9.35089 3.14711 8.99999Z" fill="white"/>
                                    <path d="M14.405 13.2984C14.1418 13.0352 13.7325 13.0352 13.4693 13.2984C13.2061 13.5615 13.2061 13.9709 13.4693 14.2341L14.405 15.1698C14.522 15.2868 14.6974 15.3745 14.8729 15.3745C15.0483 15.3745 15.2238 15.316 15.3407 15.1698C15.6039 14.9066 15.6039 14.4973 15.3407 14.2341L14.405 13.2984Z" fill="white"/>
                                    <path d="M3.99509 2.85941C3.73192 2.59624 3.32255 2.59624 3.05938 2.85941C2.79621 3.12258 2.79621 3.53195 3.05938 3.79512L3.99509 4.73083C4.11205 4.84779 4.2875 4.93552 4.46295 4.93552C4.63839 4.93552 4.81384 4.87703 4.9308 4.73083C5.19397 4.46766 5.19397 4.05829 4.9308 3.79512L3.99509 2.85941Z" fill="white"/>
                                    </svg>
                                </div>
                                <div class="p-2 w-2/4 h-full {% if  is_dark_theme %} text-primary dark:text-white bg-primary {% endif %}"> 
                                    <svg width="13" height="18" viewBox="0 0 13 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7.47795 0.882302C7.01812 0.737515 6.55828 0.621684 6.0714 0.534812C5.71976 0.476896 5.34108 0.679599 5.20583 1.02709C5.04354 1.37458 5.12469 1.80894 5.39518 2.04061C7.31566 3.95181 8.01893 6.76069 7.23451 9.39583C6.36894 12.3205 3.82633 14.3765 0.877989 14.4634C0.499303 14.4634 0.201764 14.724 0.0935677 15.1005C-0.0146284 15.4769 0.147666 15.8823 0.445205 16.085C1.12143 16.5194 1.79766 16.8669 2.47388 17.0985C3.2583 17.3592 4.06977 17.475 4.88124 17.475C6.26074 17.475 7.6132 17.0985 8.8304 16.3746C10.7509 15.2453 12.1033 13.4209 12.6984 11.2202C13.8615 6.87652 11.5624 2.33018 7.47795 0.882302ZM11.5353 10.8437C11.0484 12.726 9.85826 14.2607 8.26237 15.2163C6.58533 16.2009 4.66485 16.4036 2.85257 15.8244C2.66322 15.7665 2.44683 15.6796 2.25749 15.5928C5.12469 14.9846 7.505 12.7839 8.39762 9.77228C9.18204 7.10818 8.69516 4.2993 7.09926 2.09852C10.5615 3.3437 12.5091 7.19506 11.5353 10.8437Z" fill="currentcolor"/>
                                    </svg>          
                                </div>
                            </div>
                        </a>
                        <!-- Dropdown menu -->
                        <div class="relative mx-4" x-data="{ open: false }">
                            <button @click="open = !open"
                                class="flex items-center focus:outline-none">
                                {% if request.user.photo %}
                                <img class="w-10 h-10 rounded-full object-cover"
                                    src="{{ request.user.photo.url }}"
                                    alt="Photo de profil de {{ request.user.username }}">
                                {% else %}
                                <img class="w-10 h-10 rounded-full object-cover"
                                    src="https://randomuser.me/api/portraits/women/50.jpg"
                                    alt="Photo de profil de {{ request.user.username }}">
                                {% endif %}
                                <svg class="w-4 h-4 ml-2" fill="none"
                                    stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round"
                                        stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>

                            <!-- Dropdown content -->
                            <div x-show="open"
                                @click.away="open = false"
                                class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-900 rounded-md shadow-lg py-1"
                                style="display: none;">
                                <a href="{% url 'caisse:parametres' %}"
                                    class="block px-4 py-2 text-sm text-gray-700 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-500">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                        class="h-5 w-5 inline-block mr-2"
                                        viewBox="0 0 24 24"
                                        fill="currentColor">
                                        <path
                                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                                    </svg>
                                    Profil
                                </a>
                                <a href="{% url 'accounts:logout_user' %}"
                                    class="block px-4 py-2 text-sm text-gray-700 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-500">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                        class="h-5 w-5 inline-block mr-2"
                                        viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd"
                                            d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z"
                                            clip-rule="evenodd" />
                                    </svg>
                                    Déconnexion
                                </a>
                            </div>
                        </div>
                        
                    </div>
                </header>

                <!-- Content -->
                <main class="p-6 overflow-y-auto h-full">
                    <div class="max-h-full">
                        {% if messages %}
                        <div class="mb-4">
                            {% for message in messages %}
                            <div
                                class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-100 text-green-700{% elif message.tags == 'error' %}bg-red-100 text-red-700{% endif %}">
                                {{ message }}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                        {% block content %}
                        <!-- Page content will go here -->
                        {% endblock %}
                    </div>
                </main>
            </div>
        </div>

        <script>
    // Toggle the sidebar visibility
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarClose = document.getElementById('sidebarClose'); // New line
    const sidebar = document.getElementById('sidebar');
  
    sidebarToggle.addEventListener('click', () => {
      sidebar.classList.toggle('-translate-x-full');
    });
    
    sidebarClose.addEventListener('click', () => { // New event listener
      sidebar.classList.add('-translate-x-full');
    });
  </script>
    </body>
</html>