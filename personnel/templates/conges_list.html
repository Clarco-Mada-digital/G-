{% extends "base_primary_employee.html" %}

{% block title %} Liste des Cong√©s {% endblock %}

{% block body %}

<!-- Barre de recherche et bouton de filtrage -->
<div class="flex justify-between w-screen items-center mt-14">
    <div class="flex flex-row z-0 w-screen mb-4 ml-1">
        <input type="text" id="search-conge" name="search-conge"
            class="text-sm p-4 mt-8 w-full px-3 py-2 bg-cp_secondary border rounded-md focus:border-indigo-500"
            placeholder="üîç Recherche de cong√©" />
    </div>
    <div class="flex items-center justify-between mt-4">
        <button onclick="togglePopup()"
            class="flex gap-2 py-2 px-4 m-4 bg-white text-black text-xs rounded-md border-2 border-gray-200 duration-300 hover:scale-110">
            <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.5 6H10.5" stroke="#16151C" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                <path d="M3.5 12H12.5" stroke="#16151C" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                <path d="M19.5 12H21.5" stroke="#16151C" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                <path d="M14.5 6L21.5 6" stroke="#16151C" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                <path d="M13.5 18H20.5" stroke="#16151C" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                <path d="M3.5 18H6.5" stroke="#16151C" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                <circle cx="8.5" cy="18" r="2" stroke="#16151C" stroke-width="1.5" />
                <circle cx="17.5" cy="12" r="2" stroke="#16151C" stroke-width="1.5" />
                <circle cx="12.5" cy="6" r="2" stroke="#16151C" stroke-width="1.5" />
            </svg>
            <p class="mt-1 hidden md:block">Filtrer</p>
        </button>
    </div>
</div>

<!-- Table des cong√©s -->
<div class="bg-white shadow-md rounded-lg mt-8">
    <table class="table-auto w-full">
        <thead class="border-t border-b">
            <tr class="text-sm">
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                    Employ√©
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                    Date de d√©but
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                    Date de fin
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                    Type de cong√©
                </th>
            </tr>
        </thead>
        <tbody id="conge-list">
            <!-- Les cong√©s seront affich√©s ici via le script JavaScript -->
        </tbody>
    </table>
</div>

<!-- Pop-up de filtrage -->
<div id="filter-popup" class="hidden fixed inset-0 backdrop-blur-sm bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-white p-4 rounded-md shadow-lg w-96">
        <h2 class="text-lg font-bold mb-2">Filtrer les cong√©s</h2>
        <!-- Filtrage des cong√©s : exemple avec types de cong√© -->
        <form id="filter-form" method="GET">
            <div class="mb-4">
                <label class="block text-sm font-bold text-gray-700 mb-2">Type de cong√©</label>
                <div class="grid grid-cols-2 gap-2">
                    <!-- Types de cong√© √† cocher -->
                    <label class="flex items-center text-xs">
                        <input type="checkbox" name="type" value="annuel"
                            class="form-checkbox text-purple-600 rounded-md mr-2"> Annuel
                    </label>
                    <label class="flex items-center text-xs">
                        <input type="checkbox" name="type" value="formation"
                            class="form-checkbox text-purple-600 rounded-md mr-2"> Formation
                    </label>
                    <label class="flex items-center text-xs">
                        <input type="checkbox" name="type" value="maternit√©"
                            class="form-checkbox text-purple-600 rounded-md mr-2"> Maternit√©
                    </label>
                    <!-- Ajouter d'autres types si n√©cessaire -->
                </div>
            </div>

            <div class="flex justify-between font-medium">
                <button type="button" onclick="togglePopup()"
                    class="mr-2 bg-gray-200 text-black px-10 p-2 rounded-lg border">Retour</button>
                <button type="submit" class="bg-cp_primary text-white px-10 p-2 rounded-lg border">Appliquer</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Fonction pour basculer l'affichage du pop-up de filtrage
    function togglePopup() {
        const popup = document.getElementById('filter-popup');
        popup.classList.toggle('hidden');
    }

    // R√©cup√©rer les cong√©s via l'API REST
    fetch('/api/conges/')
        .then(response => response.json())
        .then(data => {
            let congeList = document.getElementById('conge-list');
            congeList.innerHTML = ''; // Vider le tableau avant d'ajouter les nouveaux √©l√©ments
            data.forEach(conge => {
                let row = document.createElement('tr');
                row.classList.add('bg-white', 'border-b');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${conge.employee.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${conge.start_date}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${conge.end_date}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${conge.type}</td>
                `;
                congeList.appendChild(row);
            });
        })
        .catch(error => console.error('Erreur:', error));

    // Ajouter la fonctionnalit√© de recherche
    document.getElementById('search-conge').addEventListener('input', function () {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll('#conge-list tr');
        rows.forEach(row => {
            const text = row.innerText.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    });
</script>

{% endblock %}
