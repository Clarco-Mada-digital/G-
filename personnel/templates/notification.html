{% extends "base_primary_employee.html" %}

{% block title %} Liste des notifications {% endblock %}

{% block style %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
{% endblock %}


{% block body %}
    

    <div class="max-w-screen mx-auto p-6 bg-white mt-12 rounded-lg shadow-md">
        <h2 class="text-2xl font-semibold mb-4 mt-4">Notifications</h2>
        <p class="text-gray-600 mb-6">Toutes les notifications</p>

        <div class="min-h-screen bg-white p-6">
    
            <div class="bg-white rounded-lg shadow-md max-w-screen mx-auto -mt-4 p-4 border-2 border-gray500">
 
                {% for notif in notifications %}
                <div class="flex items-center justify-between p-4">
                {% csrf_token %}
                <div class="flex items-center space-x-4">
                    {% if not notif.is_read %}
                    <form action="{% url 'personnel:mark_notification_as_read' pk=notif.notification.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="bg-cp_primary text-white p-2 rounded">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                        </button>
                    </form>
                    {% endif %}
                    <img src="{{ notif.notification.user.employee.photo.url }}" alt="" class="w-12 h-12 rounded-full">
                    <div>
                        <h3 class="font-bold">{{ notif.notification.get_type_display }}</h3>
                        <p class="text-gray-600">{{ notif.notification.message }}</p>
                    </div>
                </div>
                <small class="text-gray-300" >
                    Il y a {{ notif.notification.date_created|timesince }}
                </small>
                </div>
                    {% endfor %}


            </div>
        </div>
        </div>

{% endblock %}

{% block script %}

<script>
    // Fonction pour marquer une notification comme lue
    function markAsRead(notificationId) {
        fetch(`/${notificationId}/mark-as-read/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}',
            },
            body: {}
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Met à jour l'interface pour refléter le changement
                document.getElementById(`notification-${notificationId}`).classList.add('opacity-50');
                document.getElementById(`read-btn-${notificationId}`).style.display = 'none';
            }
        })
        .catch(error => console.error('Erreur:', error));
    }

  
</script>

{% endblock %}
